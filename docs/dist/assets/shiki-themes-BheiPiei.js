const x=[[/^(<!--)(.+)(-->)$/,!1],[/^(\/\*)(.+)(\*\/)$/,!1],[/^(\/\/|["'#]|;{1,2}|%{1,2}|--)(.*)$/,!0],[/^(\*)(.+)$/,!0]];function y(n,c,i){const r=[];for(const l of n){if(i==="v3"){const t=l.children.flatMap((s,e)=>{if(s.type!=="element")return s;const f=s.children[0];if(f.type!=="text")return s;const h=e===l.children.length-1;if(!v(f.value,h))return s;const u=f.value.split(/(\s+\/\/)/);if(u.length<=1)return s;let p=[u[0]];for(let m=1;m<u.length;m+=2)p.push(u[m]+(u[m+1]||""));return p=p.filter(Boolean),p.length<=1?s:p.map(m=>({...s,children:[{type:"text",value:m}]}))});t.length!==l.children.length&&(l.children=t)}const o=l.children;let d=o.length-1;i==="v1"?d=0:c&&(d=o.length-2);for(let t=Math.max(d,0);t<o.length;t++){const s=o[t];if(s.type!=="element")continue;const e=s.children.at(0);if(e?.type!=="text")continue;const f=t===o.length-1,h=v(e.value,f);if(h)if(c&&!f&&t!==0){const a=g(o[t-1],"{")&&g(o[t+1],"}");r.push({info:h,line:l,token:s,isLineCommentOnly:o.length===3&&s.children.length===1,isJsxStyle:a})}else r.push({info:h,line:l,token:s,isLineCommentOnly:o.length===1&&s.children.length===1,isJsxStyle:!1})}}return r}function g(n,c){if(n.type!=="element")return!1;const i=n.children[0];return i.type!=="text"?!1:i.value.trim()===c}function v(n,c){let i=n.trimStart();const r=n.length-i.length;i=i.trimEnd();const l=n.length-i.length-r;for(const[o,d]of x){if(d&&!c)continue;const t=o.exec(i);if(t)return[" ".repeat(r)+t[1],t[2],t[3]?t[3]+" ".repeat(l):void 0]}}function k(n){const c=n.match(/(?:\/\/|["'#]|;{1,2}|%{1,2}|--)(\s*)$/);return c&&c[1].trim().length===0?n.slice(0,c.index):n}function C(n,c,i,r){return r==null&&(r="v3"),{name:n,code(l){const o=l.children.filter(e=>e.type==="element"),d=[];l.data??={};const t=l.data;t._shiki_notation??=y(o,["jsx","tsx"].includes(this.options.lang),r);const s=t._shiki_notation;for(const e of s){if(e.info[1].length===0)continue;let f=o.indexOf(e.line);e.isLineCommentOnly&&r!=="v1"&&f++;let h=!1;if(e.info[1]=e.info[1].replace(c,(...u)=>i.call(this,u,e.line,e.token,o,f)?(h=!0,""):u[0]),!h)continue;r==="v1"&&(e.info[1]=k(e.info[1]));const a=e.info[1].trim().length===0;if(a&&(e.info[1]=""),a&&e.isLineCommentOnly)d.push(e.line);else if(a&&e.isJsxStyle)e.line.children.splice(e.line.children.indexOf(e.token)-1,3);else if(a)e.line.children.splice(e.line.children.indexOf(e.token),1);else{const u=e.token.children[0];u.type==="text"&&(u.value=e.info.join(""))}}for(const e of d){const f=l.children.indexOf(e),h=l.children[f+1];let a=1;h?.type==="text"&&h?.value===`
`&&(a=2),l.children.splice(f,a)}}}}function L(n){return n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function O(n={},c="@shikijs/transformers:notation-map"){const{classMap:i={},classActivePre:r=void 0}=n;return C(c,new RegExp(`\\s*\\[!code (${Object.keys(i).map(L).join("|")})(:\\d+)?\\]`),function([l,o,d=":1"],t,s,e,f){const h=Number.parseInt(d.slice(1),10);for(let a=f;a<Math.min(f+h,e.length);a++)this.addClassToHast(e[a],i[o]);return r&&this.addClassToHast(this.pre,r),!0},n.matchAlgorithm)}function $(n={}){const{classLineAdd:c="diff add",classLineRemove:i="diff remove",classActivePre:r="has-diff"}=n;return O({classMap:{"++":c,"--":i},classActivePre:r,matchAlgorithm:n.matchAlgorithm},"@shikijs/transformers:notation-diff")}export{$ as t};
